<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Tasks & Comments App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .task, .comment { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; }
    input, button { margin: 5px; padding: 5px; }
  </style>
</head>
<body>
  <h1>Tasks & Comments</h1>

  <h2>Create Task</h2>
  <input id="taskTitle" placeholder="Task title">
  <button onclick="createTask()">Create Task</button>

  <h2>Task ID (for comments)</h2>
  <input id="taskId" type="number" placeholder="Enter Task ID">
  <button onclick="loadComments()">Load Comments</button>

  <h2>Add Comment</h2>
  <input id="author" placeholder="Author">
  <input id="content" placeholder="Comment">
  <button onclick="addComment()">Add Comment</button>

  <h2>Comments</h2>
  <div id="comments"></div>

  <script>
    const BASE_URL = "http://127.0.0.1:8000";

    async function createTask() {
      const title = document.getElementById("taskTitle").value;
      const res = await fetch(`${BASE_URL}/tasks/`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title })
      });
      const data = await res.json();
      alert("Task created with ID: " + data.id);
    }

    async function loadComments() {
      const taskId = document.getElementById("taskId").value;
      const res = await fetch(`${BASE_URL}/tasks/${taskId}/comments`);
      const data = await res.json();
      const container = document.getElementById("comments");
      container.innerHTML = "";
      data.forEach(c => {
        const div = document.createElement("div");
        div.className = "comment";
        div.innerHTML = `<b>${c.author}</b>: ${c.content}
          <button onclick="deleteComment(${c.id})">Delete</button>`;
        container.appendChild(div);
      });
    }

    async function addComment() {
      const taskId = document.getElementById("taskId").value;
      const author = document.getElementById("author").value;
      const content = document.getElementById("content").value;
      const res = await fetch(`${BASE_URL}/tasks/${taskId}/comments`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ author, content })
      });
      if (res.status === 201) {
        alert("Comment added!");
        loadComments();
      } else {
        alert("Error adding comment");
      }
    }

    async function deleteComment(id) {
      const res = await fetch(`${BASE_URL}/comments/${id}`, {
        method: "DELETE"
      });
      if (res.status === 204) {
        alert("Comment deleted!");
        loadComments();
      } else {
        alert("Error deleting comment");
      }
    }
  </script>
</body>
</html>
